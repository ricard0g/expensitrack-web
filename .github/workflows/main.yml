name: Keep Backend Alive

on:
  schedule:
    # Run every 12 minutes (Render sleeps after 15m)
    # We use 12m to be safe against minor GitHub scheduler delays
    - cron: '*/12 * * * *'
  workflow_dispatch: # Allows you to run this manually from the Actions tab for testing

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render Service
        env:
          URL: ${{ secrets.RENDER_APP_URL }}
          KEY: ${{ secrets.APP_API_KEY }}
        run: |
          echo "Pinging $URL/api/ to keep it awake..."
          
          # We use --fail so the action turns Red if the server returns 4xx/5xx
          # We pass the API_KEY header to bypass your interceptor
          response=$(curl -s -o /dev/null -w "%{http_code}" --fail -X GET "$URL/api/" -H "API_KEY: $KEY")
          
          if [ "$response" -eq 200 ]; then
            echo "✅ Success! Server responded with 200 OK."
          else
            echo "❌ Failed! Server responded with $response"
            exit 1
          fi
